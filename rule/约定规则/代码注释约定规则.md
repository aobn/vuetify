# 代码注释约定规则

## 1. 总体原则

### 1.1 注释语言
- **统一使用中文注释**，确保团队成员都能理解
- 注释内容要简洁明了，避免冗余
- 注释应该解释"为什么"而不是"是什么"

### 1.2 注释风格
- 采用JSDoc标准格式
- 使用块注释（/** */）进行函数和组件注释
- 使用行注释（//）进行简单说明

## 2. Vue组件注释规范

### 2.1 组件文件头注释
```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
/**
 * 用户资料管理组件
 * 
 * 功能描述：
 * - 显示用户基本信息
 * - 支持用户信息编辑
 * - 头像上传功能
 * 
 * @author 开发者姓名
 * @since 2025-08-30
 * @version 1.0.0
 */
</script>
```

### 2.2 Props注释
```typescript
interface Props {
  /** 用户ID，必填参数 */
  userId: string
  
  /** 
   * 显示模式
   * - 'view': 只读模式
   * - 'edit': 编辑模式
   * @default 'view'
   */
  mode?: 'view' | 'edit'
  
  /** 是否显示头像，默认显示 */
  showAvatar?: boolean
}
```

### 2.3 Events注释
```typescript
const emit = defineEmits<{
  /** 用户信息更新时触发 */
  'update:user': [user: User]
  
  /** 
   * 保存操作完成时触发
   * @param success 是否保存成功
   * @param message 操作结果消息
   */
  'save-complete': [success: boolean, message: string]
}>()
```

## 3. 函数注释规范

### 3.1 普通函数注释
```typescript
/**
 * 格式化用户显示名称
 * 
 * 根据用户的姓名和昵称生成显示名称，
 * 优先显示昵称，如果没有昵称则显示真实姓名
 * 
 * @param user 用户对象
 * @param maxLength 最大显示长度，超出部分用...省略
 * @returns 格式化后的显示名称
 * 
 * @example
 * ```typescript
 * const user = { name: '张三', nickname: '小张' }
 * const displayName = formatUserDisplayName(user, 10)
 * console.log(displayName) // '小张'
 * ```
 */
export const formatUserDisplayName = (
  user: User, 
  maxLength: number = 20
): string => {
  // 实现逻辑
}
```

### 3.2 异步函数注释
```typescript
/**
 * 获取用户详细信息
 * 
 * 从服务器获取指定用户的详细信息，包括基本资料和权限信息
 * 
 * @param userId 用户ID
 * @param includePermissions 是否包含权限信息
 * @returns Promise<User> 用户详细信息
 * 
 * @throws {ApiError} 当用户不存在时抛出404错误
 * @throws {NetworkError} 当网络请求失败时抛出网络错误
 * 
 * @example
 * ```typescript
 * try {
 *   const user = await fetchUserDetail('123', true)
 *   console.log(user.name)
 * } catch (error) {
 *   console.error('获取用户信息失败:', error)
 * }
 * ```
 */
export const fetchUserDetail = async (
  userId: string,
  includePermissions: boolean = false
): Promise<User> => {
  // 实现逻辑
}
```

## 4. 类型定义注释

### 4.1 接口注释
```typescript
/**
 * 用户信息接口
 * 
 * 定义系统中用户的基本信息结构
 */
interface User {
  /** 用户唯一标识符 */
  id: string
  
  /** 用户真实姓名 */
  name: string
  
  /** 
   * 用户邮箱地址
   * 必须符合邮箱格式规范
   */
  email: string
  
  /** 
   * 用户状态
   * - 'active': 活跃用户
   * - 'inactive': 非活跃用户
   * - 'suspended': 已暂停用户
   */
  status: 'active' | 'inactive' | 'suspended'
  
  /** 
   * 用户创建时间
   * ISO 8601格式的时间字符串
   */
  createdAt: string
}
```

### 4.2 类型别名注释
```typescript
/** 
 * API响应状态码类型
 * 定义所有可能的HTTP状态码
 */
type ApiStatusCode = 200 | 400 | 401 | 403 | 404 | 500

/**
 * 表单验证规则类型
 * 用于定义表单字段的验证规则
 */
type ValidationRule = (value: any) => boolean | string
```

## 5. 复杂逻辑注释

### 5.1 算法逻辑注释
```typescript
const calculateUserScore = (user: User): number => {
  // 基础分数：所有用户起始分数为100分
  let score = 100
  
  // 根据用户活跃度调整分数
  // 活跃用户加20分，非活跃用户减10分
  if (user.status === 'active') {
    score += 20
  } else if (user.status === 'inactive') {
    score -= 10
  }
  
  // 根据注册时长调整分数
  // 每满一年加5分，最多加50分
  const yearsSinceRegistration = getYearsSince(user.createdAt)
  score += Math.min(yearsSinceRegistration * 5, 50)
  
  return score
}
```

### 5.2 业务逻辑注释
```typescript
const processOrderPayment = async (orderId: string) => {
  // STEP 1: 验证订单状态
  // 只有待支付状态的订单才能进行支付处理
  const order = await getOrder(orderId)
  if (order.status !== 'pending_payment') {
    throw new Error('订单状态不允许支付')
  }
  
  // STEP 2: 调用支付网关
  // 使用第三方支付服务处理支付请求
  try {
    const paymentResult = await paymentGateway.process(order)
    
    // STEP 3: 更新订单状态
    // 根据支付结果更新订单状态
    if (paymentResult.success) {
      await updateOrderStatus(orderId, 'paid')
      // 发送支付成功通知
      await sendPaymentNotification(order.userId, 'success')
    } else {
      await updateOrderStatus(orderId, 'payment_failed')
      // 记录支付失败原因
      await logPaymentFailure(orderId, paymentResult.error)
    }
  } catch (error) {
    // 支付网关异常处理
    console.error('支付网关调用失败:', error)
    await updateOrderStatus(orderId, 'payment_error')
    throw error
  }
}
```

## 6. 特殊标记注释

### 6.1 TODO注释
```typescript
// TODO: 需要添加用户权限验证逻辑
// 预计完成时间: 2025-09-01
// 负责人: 张三
const deleteUser = (userId: string) => {
  // 当前实现
}
```

### 6.2 FIXME注释
```typescript
// FIXME: 这里存在内存泄漏问题
// 问题描述: 事件监听器没有正确清理
// 影响范围: 长时间使用会导致内存占用过高
// 优先级: 高
const setupEventListeners = () => {
  // 有问题的代码
}
```

### 6.3 HACK注释
```typescript
// HACK: 临时解决方案，等待第三方库修复
// 问题: 第三方库在某些情况下返回null而不是空数组
// 临时方案: 手动转换null为空数组
// 跟踪: GitHub Issue #123
const processApiResponse = (response: any) => {
  return response?.data || [] // 临时处理null情况
}
```

### 6.4 NOTE注释
```typescript
// NOTE: 重要说明
// 这个函数的执行顺序很重要，必须在用户认证之后调用
// 修改时请确保不会影响认证流程
const initializeUserSession = () => {
  // 实现逻辑
}
```

## 7. 测试代码注释

### 7.1 测试套件注释
```typescript
/**
 * 用户管理组件测试套件
 * 
 * 测试覆盖范围：
 * - 组件渲染测试
 * - 用户交互测试
 * - Props传递测试
 * - Events触发测试
 */
describe('UserManagement', () => {
  // 测试用例
})
```

### 7.2 测试用例注释
```typescript
/**
 * 测试用户信息显示功能
 * 
 * 验证点：
 * 1. 正确显示用户姓名
 * 2. 正确显示用户邮箱
 * 3. 根据用户状态显示对应的状态标签
 */
it('should display user information correctly', () => {
  // 测试实现
})
```

## 8. 注释维护规范

### 8.1 注释更新原则
- 代码修改时必须同步更新相关注释
- 删除无效或过时的注释
- 定期审查注释的准确性

### 8.2 注释审查要点
- 注释是否与代码逻辑一致
- 注释是否提供了有价值的信息
- 注释格式是否符合规范
- 是否存在拼写或语法错误

## 9. 工具配置

### 9.1 VSCode插件推荐
- **Auto Comment Blocks**: 自动生成JSDoc注释
- **Better Comments**: 高亮特殊注释标记
- **Document This**: 快速生成函数注释

### 9.2 ESLint规则
```json
{
  "rules": {
    "valid-jsdoc": "error",
    "require-jsdoc": ["error", {
      "require": {
        "FunctionDeclaration": true,
        "MethodDefinition": true,
        "ClassDeclaration": true
      }
    }]
  }
}
```

## 10. 注释示例模板

### 10.1 Vue组件模板
```vue
<template>
  <!-- 组件模板 -->
</template>

<script setup lang="ts">
/**
 * [组件名称]
 * 
 * [组件功能描述]
 * 
 * @author [开发者]
 * @since [创建日期]
 * @version [版本号]
 */

// 导入依赖
import { ref, computed } from 'vue'

// Props定义
interface Props {
  /** [属性描述] */
  propName: string
}

// 响应式数据
/** [数据描述] */
const reactiveData = ref('')

// 计算属性
/** [计算属性描述] */
const computedValue = computed(() => {
  // 计算逻辑
})

// 方法定义
/**
 * [方法描述]
 * @param param [参数描述]
 * @returns [返回值描述]
 */
const methodName = (param: string) => {
  // 方法实现
}
</script>
```

### 10.2 工具函数模板
```typescript
/**
 * [函数名称]
 * 
 * [函数功能描述]
 * 
 * @param param1 [参数1描述]
 * @param param2 [参数2描述]
 * @returns [返回值描述]
 * 
 * @throws {ErrorType} [异常描述]
 * 
 * @example
 * ```typescript
 * // 使用示例
 * const result = functionName(param1, param2)
 * ```
 * 
 * @since [创建日期]
 * @author [开发者]
 */
export const functionName = (param1: string, param2: number): ReturnType => {
  // 函数实现
}
```

## 更新记录
- 2025-08-30: 创建代码注释约定规则文档